<canvas height=300 width=300 id="slate" style="border:1px solid #000000;"></canvas>
<button id="clear">Reset</button>
<button id="easy">Easy</button>
<button id="med">Medium</button>
<button id="hard">Hard</button>

<script>
  var c = document.getElementById("slate");
  var ctx = c.getContext("2d");

  var clr = document.getElementById("clear");
  var eas = document.getElementById("easy");
  var med = document.getElementById("med");
  var hrd = document.getElementById("hard");

var powerups = [];
var paddlev = 0;
var pycor = window.innerHeight/2 - 30;
var plength = 75;
var pxcor = 30;

var aiycor = window.innerHeight/2 -30;

  var pad = new Image();
  pad.src = "paddle.png";

  var ball = new Image();
  ball.src = "ball.png";

  ctx.fillStyle = "#f0f000";
  ctx.strokeStyle = "#00f0f0";
/** Suggestion for organizing code
 *
 *
 *

  var Ball = {
    coors: {
      x: 0,
      y: 0
    },
    velocity: {
      x: 0,
      y: 0
    },
    render: function () {

    }
  }

  var Player = {
    score: 0,
    pos: 0,
    velocity: 0,
    render: function () {

    },
    move: function () {

    }
  }

  var Computer = {
    score: 0,
    pos: 0,
    velocity: 0,
    predict: function () {

    }
    render: function () {

    },
    move: function () {

    }
  }
**/

  var xcor;
  var ycor;
  var yv = 0;
  var xv = 0;

  var pscore;
  var cscore;

  var exist = false;
  var run = false;
  var difficulty = 1;

var start = function(e){
  e.preventDefault();
  ctx.canvas.width  = window.innerWidth;
  ctx.canvas.height = window.innerHeight;
  if (! exist){
      xcor = window.innerWidth - 50;
      ycor = window.innerHeight/2;
      yv = -20;
      xv = Math.random() * 40 - 20;
      exist = !exist;
      run = true;

window.requestAnimationFrame(play);
  }
  if (! run){
run = ! run;
	window.requestAnimationFrame(play);
    
  } 
}

var makePowerUp =  function(a,x,y){
	var z = {};
	z["type"] = a;
	z["xcor"] = x;
z["ycor"] = y;
//correction type --> z["type"] 
	if (z["type"] == "bpaddle" || z["type"] == "smallpaddle"){
		z["time"] = 600;
	}
	else {
		z["time"] = 1;
	}
	return z;
}
var makeRandomLoc = function(a){
	var newx = Math.random() * (window.innerWidth - 60) + 30;
	var newy = Math.random() * (window.innerHeight - 60) + 30;
	return makePowerUp(a,newx,newy);
}

var  randomPowerUp = function(){
	var types = ["bpaddle","smallpaddle","fast","slow","randdir"];
	var type = types[Math.floor(Math.random() * 5)];
	powerups[powerups.length] = makeRandomLoc(type);
}

var clear = function(e){
	e.preventDefault();
	exist = false;
	run = false;
	ctx.clearRect(0,0,c.width,c.height);
	window.cancelAnimationFrame(play);
	}

var play = function(){
	ctx.clearRect(0,0,c.width,c.height);
	movePaddle();	
	moveBall();
	//moveAi();
	if (Math.floor(Math.random() * 100) == 1){
		randomPowerUp();
	}
	checkScore();
		if (run){
		window.requestAnimationFrame(play);
	}
}

var movePaddle = function(){
	pycor = pycor + paddlev;
/*
		    if (findIn("bpaddle") != -1){
		plength = 150;
		powerups[findIn("bpaddle")]["time"] = powerups[findIn("bpaddle")]["time"] - 1;
		if (powerups[findIn("bpaddle")]["time"] == 0){
			powerups.splice(powerups[findIn("bpaddle")], 1);
		}
						      }
	if (findIn("smallpaddle") != -1){
		plength = 50;
		powerups[findIn("smallpaddle")]["time"] = powerups[findIn("smallpaddle")]["time"] - 1;
		if (powerups[findIn("smallpaddle")]["time"] == 0){
			plength = 50;
			powerups.splice(powerups[findIn("smallpaddle")], 1);
		}
	}
	*/			      
	ctx.drawImage(pad, 30, pycor, 10, plength);
}


var moveBall = function(){
	if ( (xcor > window.innerWidth - 50 && ycor > aiycor && ycor < aiycor + 30)  || (xcor < 40 && ycor > pycor && ycor < pycor + plength)) {
		xv *= -1
	}
	if (ycor > window.innerHeight || ycor <  0){
		yv  *= -1
						      }
						      /*
	if (findIn("randdir") != -1){
		xv = Math.random() * 40 - 20;
		yv = Math.random() * 40 - 20;
		powerups[findIn("randdir")]["time"] = powerups[findIn("randdir")]["time"] - 1;
		if (powerups[findIn("randdir")]["time"] == 0){
			powerups.splice(powerups[findIn("randdir")], 1);
		}
	}
	if (findIn("slow") != -1){
		xv = xv / 2;
		yv = yv / 2;
		powerups[findIn("slow")]["time"] = powerups[findIn("slow")]["time"] - 1;
		if (powerups[findIn("slow")]["time"] == 0){
			powerups.splice(powerups[findIn("slow")], 1);
		}
						      }
						      
	if (findIn("fast") != -1){
		xv = xv * 2;
		yv = yv * 2;
		powerups[findIn("fast")]["time"] = powerups[findIn("fast")]["time"] - 1;
		if (powerups[findIn("fast")]["time"] == 0){
			powerups.splice(powerups[findIn("fast")], 1);
		}
						      }
						      */
	xcor += xv;
	ycor += yv;
	ctx.drawImage(ball, xcor, ycor, 10, 10);
}

var findIn = function(a){
	for( i = 0; i < powerups.length; i++){
		if (powerups[i]["type"] == a){
			return i;
		}
	}
	return -1;
}
	
var checkScore = function(){
	if (xcor > window.innerWidth - 30){
		pscore = pscore + 1;
	ballReset()
	}
	if (xcor <  30){
		cscore = cscore + 1;
		ballReset()
	}
}

var ballReset = function(){
	xcor = window.innerWidth/2;
	ycor = window.innerHeight/2;
	xv = 20 * Math.random() - 10;
	yv = 20 * Math.random() - 10;
	
		    }

var aiMove = function(){
	var x = aiPredict();
}
		    

var aiPredict = function(){
	if (xv > 0){
	var t = (window.innerWidth - 30 - xcor)/xv
	var x = Math.abs(t*yv - ycor)%(window.innerHeight - 60)* Math.pow(-1, Math.floor(Math.abs(t*yv - ycor)/(window.innerHeight - 60)) + (window.innerHeight - 60)/2);
	}
	if (xv < 0){
	var t = ( window.innerWidth - 90 + xcor)/xv
	var x = Math.abs(t*yv - ycor)%(window.innerHeight - 60) * Math.pow(-1, Math.floor(Math.abs(t*yv - ycor)/(window.innerHeight - 60)) + (window.innerHeight - 60)/2);
	}
	return x 
}



var paddleDown = function(e){
	key = e.keyCode;
	if (paddlev == 0){
		paddlev = 10;}
	if (key == 40){
		paddlev = Math.abs(paddlev);
	}
	else if (key == 38){
		paddlev = -1 * Math.abs(paddlev);
	}
	console.log("keydown");
}

var paddleUp = function(e){
	key = e.keyCode;
	if (key == 40 && paddlev > 0){
		paddlev = 0;
	}
	else if (key == 38 && paddlev < 0){
		paddlev = 0;
	}
}

document.addEventListener("keyup",paddleUp);
document.addEventListener("keydown", paddleDown);
eas.addEventListener("click", start);
</script>